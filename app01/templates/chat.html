{% extends "layout.html" %}

{% block content %}
    <style>
        .message {
            height: 600px;
            width: 500px;
            box-shadow: grey;
        }
    </style>

    <div class="message" id="message"></div>
    <div>
        <input type="text" id="txt">
        <input type="button" value="Send" onclick="sendMessage();">
    </div>

    <div style="height: 1000px"></div>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>

        var max_index = 0;

        function sendMessage() {
            var text = $("#txt").val();

            $.ajax({
                url: "/send/msg/",
                type: "GET",
                data: {
                    text: text
                },
                success: function (res) {
                    console.log("Send successfully", res)
                }
            })
        }

        setInterval(function () {

            $.ajax({
                url: "/get/msg/",
                type: "GET",
                data: {
                    index: max_index
                },
                success: function (dataDict) {
                    {#console.log("Received message --> ", res);#}
                    {#var dataDict = JSON.parse(res);#}
                    max_index = dataDict.max_index;

                    $.each(dataDict.data, function (index, item) {
                        console.log(index, item);
                        // 拼接成div标签, 并添加到message区域
                        var tag = $("<div>");
                        tag.text(item)
                        $("#message").append(tag)
                    })
                }
            })
        }, 2000)
    </script>

{% endblock %}